---
alwaysApply: true
---

# Logia Genesis - Cursor Rules

This file contains project-specific rules and conventions for the Logia Genesis website. These rules should be followed when writing, modifying, or refactoring code.

## ⚠️ IMPORTANT: Keep This File Updated

**When making changes that affect project structure, conventions, or patterns, update this file accordingly.**

Examples of changes that require updates:
- Adding new file structure patterns
- Changing naming conventions
- Adding new build processes
- Introducing new frameworks or libraries
- Modifying component patterns
- Changing performance optimization strategies
- Updating documentation standards

---

## Project Overview

**Logia Genesis** - Business technology solutions provider website
- **Tech Stack**: Vanilla HTML, CSS, JavaScript (ES6+), Vite, Alpine.js
- **Architecture**: Component-based, modular, performance-focused
- **Build Tool**: Vite 5.x
- **Style**: Modern, responsive, dark/light mode support

---

## File Structure & Organization

### Directory Structure
```
logia/
├── components/          # Reusable HTML components (navbar, footer)
├── public/              # Public static files (service worker, data)
│   ├── service-worker.js # Enhanced service worker with multi-layer caching
│   └── data/            # Runtime data (copied to build output)
├── css/                # Stylesheets (modular structure)
│   ├── core/           # Core foundation styles
│   │   ├── variables.css    # Design tokens (colors, spacing, etc.)
│   │   ├── reset.css       # CSS reset & base styles
│   │   ├── typography.css  # Typography styles
│   │   └── utilities.css   # Utility classes
│   ├── components/     # Reusable UI components
│   │   ├── buttons.css     # Button styles
│   │   ├── cards.css       # Generic card patterns
│   │   ├── forms.css       # Form elements
│   │   ├── carousel.css    # Carousel component
│   │   ├── floating-buttons.css # Scroll-to-top, WhatsApp buttons
│   │   ├── skeleton.css    # Skeleton loaders (animated loading placeholders)
│   │   ├── timeline.css    # Timeline component (vertical process/journey flow)
│   │   └── bento-grid.css  # Bento grid layout component
│   ├── layout/         # Layout components
│   │   ├── container.css   # Container utilities
│   │   ├── navbar.css      # Navigation bar
│   │   ├── hero.css        # Hero section
│   │   ├── page-header.css # Page headers (shared)
│   │   └── footer.css      # Footer component
│   ├── sections/       # Homepage sections
│   │   ├── _section-header.css # Shared section headers
│   │   ├── services.css        # Services section
│   │   ├── why-choose.css      # Why Choose section
│   │   ├── portfolio-preview.css # Portfolio preview
│   │   ├── testimonials.css     # Testimonials section
│   │   ├── instagram.css        # Instagram feed
│   │   └── cta.css              # CTA section
│   ├── pages/          # Page-specific styles
│   │   ├── about.css
│   │   ├── contact.css
│   │   ├── services.css
│   │   ├── portfolio.css
│   │   ├── legal.css
│   │   ├── speedtest.css
│   │   └── resources.css
│   ├── responsive/     # Responsive adjustments
│   │   ├── mobile.css      # Mobile breakpoints
│   │   ├── tablet.css      # Tablet breakpoints
│   │   └── desktop.css     # Desktop optimizations
│   ├── fonts/          # Font definitions
│   │   ├── inter-fonts.css
│   │   └── fontawesome-local.css
│   └── style.css       # Main entry point (imports all modules)
├── js/                 # JavaScript modules (ES6)
│   ├── particles-net.js # Particles background system (CTA sections)
│   ├── particlesjs-config.json # Particles configuration
│   ├── page-transitions.js # Smooth page transitions with skeleton loading
│   ├── cache-manager.js # In-memory cache manager for pages and data
│   ├── cache-warming.js # Cache warming for critical pages and data
│   └── *.js            # Other JS modules
├── utils/              # Utility functions
│   ├── theme.js        # Theme management (dark/light mode)
│   ├── path.js         # Path utilities (GitHub Pages base path)
│   ├── dom.js          # DOM manipulation
│   ├── performance.js  # Performance utilities
│   ├── validation.js   # Form validation
│   ├── scroll-handler.js # Unified scroll handler
│   └── index.js        # Utility exports
├── js/utils/           # JavaScript utilities (duplicate theme.js for early load)
├── config/             # Configuration files (app config, build plugins)
├── assets/             # Static assets (images, fonts)
│   ├── images/         # Image files (with responsive optimization)
│   └── fonts/          # Font files
├── docs/               # Documentation (all .md files)
├── dist/               # Production build output (generated, gitignored)
├── dist-gh-pages/      # GitHub Pages build output (generated, gitignored)
├── .github/workflows/  # GitHub Actions workflows
├── robots.txt          # SEO robots file
├── sitemap.xml         # SEO sitemap
├── 404.html            # Custom error page
├── privacy-policy.html  # Privacy policy
├── terms-of-service.html # Terms of service
└── *.html              # Page templates
```

### File Naming Conventions
- **HTML**: kebab-case (e.g., `about.html`, `contact.html`)
- **CSS**: kebab-case (e.g., `style.css`, `about.css`)
- **JavaScript**: kebab-case (e.g., `main.js`, `components.js`)
- **Components**: kebab-case (e.g., `navbar.html`, `footer.html`)
- **Images**: kebab-case with descriptive names (e.g., `hero-background.jpg`)
- **Documentation**: UPPER_SNAKE_CASE (e.g., `ARCHITECTURE.md`, `STYLE_GUIDE.md`)

---

## CSS Conventions

### Naming Pattern: BEM-Inspired
- **Blocks**: `.hero`, `.navbar`, `.service-card`
- **Elements**: `.hero__title`, `.navbar__link`, `.service-card__icon`
- **Modifiers**: `.btn--primary`, `.btn--outline`, `.card--active`
- **States**: `.active`, `.visible`, `.scrolled`, `.dark-mode`

### CSS Variables (Design Tokens)
Always use CSS custom properties defined in `css/core/variables.css`:
- Colors: `var(--color-primary)`, `var(--color-accent)`, `var(--color-text)`
- Spacing: `var(--space-1)` through `var(--space-24)` (8px grid system)
- Typography: `var(--font-primary)`
- Shadows: `var(--shadow-sm)` through `var(--shadow-xl)`
- Border Radius: `var(--radius-sm)` through `var(--radius-full)`
- Transitions: `var(--transition-fast)`, `var(--transition-base)`, `var(--transition-slow)`

### CSS Organization (Modular Structure)
- **Main stylesheet** (`css/style.css`): Aggregates all modular CSS files via @import
- **Core** (`css/core/`): Foundation styles (variables, reset, typography, utilities)
- **Components** (`css/components/`): Reusable UI components (buttons, cards, forms, carousel, floating buttons, skeleton loaders, timeline, bento-grid)
- **Layout** (`css/layout/`): Structural components (navbar, hero, footer, page-header, container)
- **Sections** (`css/sections/`): Homepage sections (services, why-choose, portfolio-preview, testimonials, instagram, cta)
- **Pages** (`css/pages/`): Page-specific styles (about, contact, services, portfolio, legal, speedtest, resources)
- **Responsive** (`css/responsive/`): Responsive adjustments (mobile, tablet, desktop)
- **Fonts** (`css/fonts/`): Font definitions (inter-fonts, fontawesome-local)
- **Mobile-first**: Write mobile styles first, then use `@media` for larger screens
- **Dark mode**: Use `body.dark-mode` selector for dark mode overrides

### CSS Best Practices
- ✅ Use CSS variables for all design tokens
- ✅ Follow the 8px spacing grid system
- ✅ Use semantic class names (describe purpose, not appearance)
- ✅ Keep page-specific CSS in separate files
- ✅ Use `clamp()` for responsive typography
- ✅ **Cross-browser compatibility**: Quote @font-face URLs, include semicolons, use `text-size-adjust: 100%` on root
- ✅ **Chrome Animation Optimization**:
  - Use `contain: layout style paint` on animated elements
  - Set `will-change` only during active animations (hover states), remove with `will-change: auto` when idle
  - Avoid unnecessary `translate3d(0,0,0)` - use only needed transforms (`scale()`, `translateY()`, etc.)
  - Use separate transition properties instead of shorthand for better Chrome performance
  - Add `backface-visibility: hidden` for hardware acceleration
- ❌ Never hardcode colors, spacing, or other design tokens
- ❌ Avoid inline styles (except for dynamic JS-generated styles)
- ❌ Don't use `!important` unless absolutely necessary
- ❌ Don't use `translate3d(0,0,0)` when you only need `scale()` or `translateY()`

---

## JavaScript Conventions

### Module Pattern (ES6)
- Use ES6 `import/export` syntax
- Keep modules focused and single-purpose
- Export named exports, not default exports (except for main entry points)

### Utility Functions
Use utility functions from `utils/`:
- **DOM**: `$()`, `$$()`, `waitForElement()`, `isInViewport()`
- **Performance**: `debounce()`, `throttle()`, `logPerformance()`
- **Validation**: `validateEmail()`, `validatePhone()`, `showError()`, `showSuccessMessage()`
- **Scroll Handler**: `initScrollHandlers()` from `utils/scroll-handler.js` (unified scroll handler)
- **Theme**: `themeManager` from `utils/theme.js` or `js/utils/theme.js` (dark/light mode with system preference)
- **Path**: `getBasePath()`, `getResourcePath()` from `utils/path.js` (GitHub Pages path handling)
- **Particles**: `initCTANetBackgrounds()` from `js/particles-net.js` (lazy-loaded, auto-initializes on CTA sections, uses static imports for proper bundling)
- **Cache**: `cacheManager` from `js/cache-manager.js` (in-memory caching for pages and data)
- **Page Transitions**: `initPageTransitions()` from `js/page-transitions.js` (smooth navigation with skeleton loading)

### Code Style
- Use `const` by default, `let` when reassignment needed, avoid `var`
- Use arrow functions for callbacks
- Use template literals for string interpolation
- Use destructuring for object/array access
- Use async/await for asynchronous code
- Add JSDoc comments for all functions

### Performance Patterns
- Use `debounce()` for search inputs, resize handlers
- Use unified scroll handler for all scroll events (single throttled handler)
- Use event delegation instead of individual listeners
- Use lazy loading for non-critical functionality (`js/lazy/`, `particles-net.js`)
- Use `IntersectionObserver` for lazy loading images and pausing animations when not visible
- Use `requestAnimationFrame` for animations
- Avoid blocking the main thread

### Initialization Pattern
```javascript
// Check if already initialized
if (element.dataset.initialized === 'true') return;
element.dataset.initialized = 'true';

// Initialize functionality
```

---

## HTML Conventions

### Semantic HTML
- Use semantic HTML5 elements (`<header>`, `<nav>`, `<main>`, `<section>`, `<article>`, `<footer>`)
- Use proper heading hierarchy (h1 → h2 → h3)
- Add ARIA labels for icon-only buttons and complex components
- Include alt text for all images

### Component Loading
```html
<!-- Component placeholders -->
<div id="navbar-placeholder"></div>
<div id="footer-placeholder"></div>

<!-- Scripts (in order) -->
<!-- Theme Manager - Load early to prevent FOUC -->
<script type="module" src="js/utils/theme.js"></script>
<script type="module" src="js/components.js"></script>
<script type="module" src="js/alpine-setup.js"></script>
<script type="module" src="js/main.js"></script>
```

### FOUC Prevention & CSP (Required on All Pages)
All HTML pages must include the theme initialization **script tag** in `<head>` immediately after the viewport meta and before any CSS, along with a Content Security Policy meta tag:

```html
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Content Security Policy -->
<!-- Note: speedtest.html includes https://speed.cloudflare.com in frame-src -->
<meta http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://*.sentry.io; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://formspree.io https://*.sentry.io https://api.instagram.com; frame-src 'self' https://www.google.com https://speed.cloudflare.com; form-action 'self' https://formspree.io; base-uri 'self'; object-src 'none'; upgrade-insecure-requests;">

<!-- Theme initialization script - prevents FOUC (Flash of Unstyled Content) -->
<!-- MUST be before any CSS or other content -->
<script src="js/utils/theme-init.js"></script>
```

### Meta Tags
- Include proper `<meta>` tags (charset, viewport, description, keywords)
- **Open Graph tags** - Required on all pages for social sharing
- **Twitter Card tags** - Required on all pages for Twitter sharing
- **Canonical URLs** - Required on all pages (automatically transformed by build)
- Include comprehensive favicon links (SVG, PNG sizes, Windows tiles)

### Favicon Implementation
All HTML files must include complete favicon setup:
```html
<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="manifest" href="/site.webmanifest">
<!-- Windows Tiles -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-150x150.png">
<meta name="msapplication-square150x150logo" content="/mstile-150x150.png">
<meta name="msapplication-wide310x150logo" content="/mstile-310x310.png">
<meta name="msapplication-square310x310logo" content="/mstile-310x310.png">
```

### SEO Files
- `sitemap.xml` - XML sitemap for search engines (all pages included, URLs auto-transformed)
- `site.webmanifest` - Web app manifest for PWA support
- `robots.txt` - Robots exclusion file (sitemap URL auto-transformed)
- **Structured Data (JSON-LD)** - Organization, LocalBusiness, Service, BreadcrumbList schemas on all pages
- **404.html** - Custom error page
- **privacy-policy.html** - Privacy policy page
- **terms-of-service.html** - Terms of service page

### Resource Hints
- Use `preconnect` for external domains (fonts, CDNs)
- Use `preload` for critical CSS/JS modules (not recommended for responsive images - causes browser warnings)
- Use `prefetch` for likely next pages
- Use `dns-prefetch` for external domains
- **Note**: For critical images, use `loading="eager"` and `fetchpriority="high"` on the `<img>` element instead of preload links

---

## Image Optimization

### Image Implementation
- Always use `<picture>` element with WebP and fallback
- Include responsive `srcset` with multiple sizes (320w, 640w, 768w, 1024w, 1280w, 1920w)
- Use appropriate `sizes` attribute
- Add `loading="lazy"` for below-fold images
- Add `loading="eager"` and `fetchpriority="high"` for hero/above-fold images
- Always include descriptive `alt` text

### Image File Organization
- Place images in `assets/images/` (or subdirectories)
- Use descriptive kebab-case filenames
- **Source format**: Use JPG or PNG only (NOT WebP - WebP/AVIF are generated during build)
- Build process automatically generates responsive sizes, WebP, AVIF versions, and blur placeholders

### Image Patterns
```html
<picture>
  <source srcset="..." sizes="..." type="image/webp">
  <source srcset="..." sizes="..." type="image/jpeg">
  <img src="..." srcset="..." sizes="..." alt="..." loading="..." decoding="async">
</picture>
```

---

## Component System

### Component Loading
- Components loaded via `js/components.js`
- Components are HTML files in `components/` directory
- Loaded asynchronously and inserted into placeholders
- Initialization callbacks run after component load

### Component Pattern
```html
<!-- In component file (e.g., components/navbar.html) -->
<nav class="navbar" id="navbar">
  <!-- Component content -->
</nav>
```

```html
<!-- In page file -->
<div id="navbar-placeholder"></div>
```

### Alpine.js Components
- Use Alpine.js for reactive components
- Define data in `js/alpine-setup.js` or inline with `x-data`
- Use Alpine directives: `x-data`, `x-show`, `x-if`, `x-for`, `x-on`, etc.

---

## Build System (Vite)

### Dual Build System
The project supports two build targets:
- **Production Build** (`npm run build`): Outputs to `dist/` for normal server/FTP deployment
  - Base URL: `https://www.logia.co.za`
  - For FTP upload to production server
- **GitHub Pages Build** (`npm run build:gh-pages`): Outputs to `dist-gh-pages/` for GitHub Pages
  - Base URL: `https://courage-1984.github.io/logia`
  - Base Path: `/logia/`
  - Automatically deployed via GitHub Actions
- **Build Both** (`npm run build:all`): Builds both targets sequentially

### Build Configuration
- **Entry points**: All HTML files in root (including 404.html, privacy-policy.html, terms-of-service.html)
- **Output**: `dist/` (production) or `dist-gh-pages/` (GitHub Pages)
- **Assets**: Hashed filenames for cache busting
- **Code splitting**: Enabled for CSS and JS
- **Minification**: Enabled for production
- **URL Transformation**: Automatic URL transformation based on build target (canonical, OG, Twitter, structured data)

### Build Plugins
- `copyComponents()`: Copies components to output directory
- `copyFonts()`: Copies fonts to output directory
- `copyFontCSS()`: Copies font CSS files from `css/fonts/` (inter-fonts.css, fontawesome-local.css)
- `copyDataDirectory()`: Copies data directory (Google Reviews, Instagram posts JSON)
- `copyJSAssets()`: Copies runtime JSON configs (e.g., `particlesjs-config.json`)
- `copyStaticAssets()`: Copies favicons, sitemap, robots.txt, web manifest, 404.html, legal pages
- `imageOptimization()`: Generates responsive images (WebP, AVIF, responsive sizes, blur placeholders)
- `urlTransformPlugin()`: Transforms URLs based on build target
- `staticFilesTransformPlugin()`: Transforms sitemap.xml and robots.txt URLs
- Compression plugins: Gzip and Brotli compression
- Bundle analyzer: Generates `stats.html` in each output directory
- **All plugins run for both build targets** (production and GitHub Pages)

### Development
- Run `npm run dev` for development server (port 3000)
- Hot Module Replacement (HMR) enabled
- Source maps enabled in development

### Build Commands
- `npm run build` - Production build (normal server/FTP)
- `npm run build:gh-pages` - GitHub Pages build
- `npm run build:all` - Build both targets
- `npm run preview` - Preview production build (serves only built files from dist/)
- `npm run preview:gh-pages` - Preview GitHub Pages build (serves only built files from dist-gh-pages/)

### Configuration Files
- `config/build-config.js` - Build target configuration (URLs, basePath, output directories)
- `vite.config.js` - Vite build configuration

---

## Performance Guidelines

### Critical Path
- Inline critical CSS in `<head>` (when implemented)
- Use `loading="eager"` and `fetchpriority="high"` for critical images (not preload links)
- Preload critical JavaScript modules (modulepreload)
- Defer non-critical JavaScript
- Lazy load below-fold content

### Resource Loading
- Self-host Font Awesome (zero external requests)
- Use `font-display: swap` for fonts
- Reduce font weights to only needed ones (400, 600, 700)
- Preconnect to external domains (if any)
- **Cross-browser font fixes**: Quoted URLs in @font-face, semicolons, text-size-adjust normalization

### Code Optimization
- Code splitting enabled (vendor, utils, components chunks)
- Lazy load non-critical features (FAQ, filters, search in `js/lazy/`)
- Use unified scroll handler for all scroll events
- Use event delegation instead of individual listeners
- Remove unused code (tree-shaking enabled)

### Animations & Motion
- **Chrome Optimization**: Optimized for smooth animations in Chrome
  - `will-change` only set during active animations (hover states), removed when idle (`will-change: auto`)
  - CSS containment (`contain: layout style paint`) for better rendering isolation
  - Avoid unnecessary `translate3d(0,0,0)` - use only needed transforms (`scale()`, `translateY()`, etc.)
  - Use separate transition properties (`transition-property`, `transition-duration`, `transition-timing-function`) for better Chrome performance
  - `backface-visibility: hidden` on animated elements for hardware acceleration
- Disable heavier effects (3D tilt, particles) on coarse pointers (touch/mobile devices).
- Use `will-change` only during active animations, not statically on all elements.

### Image Optimization
- **Source Format**: Use JPG or PNG in `assets/images/` (NOT WebP - generated during build)
- Use responsive images with srcset (6 sizes: 320w-1920w)
- Use AVIF → WebP → JPEG format priority
- Optimize image quality (85% for WebP/JPEG, 80% for AVIF)
- Lazy load below-fold images
- Blur placeholders generated during build
- Build process generates all formats automatically

See `docs/PERFORMANCE_OPTIMIZATION.md` and `docs/IMAGE_GUIDE.md` for detailed optimization strategies.

---

## Accessibility

### Requirements
- WCAG AA compliance minimum
- Semantic HTML structure
- Proper heading hierarchy
- ARIA labels for icon-only buttons
- Keyboard navigation support
- Focus management
- Color contrast compliance

### Color Contrast
- Text on background: 4.5:1 minimum (WCAG AA)
- Large text: 3:1 minimum
- Interactive elements: Clear focus states

### Keyboard Navigation
- All interactive elements keyboard accessible
- Focus indicators visible
- Logical tab order
- **Skip Links**: Implemented on all pages (skip to main content, services, footer)
  - Styled in `css/style.css` (hidden by default, visible on focus)
  - Target IDs: `#main-content`, `#services` (homepage), `#footer`

---

## Dark Mode

### Implementation
- **Theme Manager**: Centralized theme management via `utils/theme.js` and `js/utils/theme.js`
- **System Preference**: Automatically detects `prefers-color-scheme` if no user preference set
- **FOUC Prevention**: Early `js/utils/theme-init.js` script in `<head>` applies theme before CSS loads
- **Persistence**: Theme preference saved to localStorage
- **Smooth Transitions**: 300ms transitions via `--transition-theme` CSS variable
- **Event System**: Dispatches `themechange` event for component synchronization

### Usage
```javascript
// Theme manager initializes automatically
// Access via window.themeManager
window.themeManager.toggle(); // Toggle theme
window.themeManager.setTheme('dark'); // Set specific theme
window.themeManager.getTheme(); // Get current theme
```

### Color Mapping
- Use CSS variables that adapt to dark mode
- Test all components in both modes
- Ensure contrast ratios maintained

---

## Documentation Standards

### Code Documentation
- Add JSDoc comments to all JavaScript functions
- Include parameter types and return types
- Document complex logic with inline comments
- Keep comments up-to-date with code

### File Documentation
- Each major file should have a header comment describing its purpose
- Document complex algorithms or patterns
- Include usage examples for utility functions

### Project Documentation
- All documentation in `docs/` folder
- Use Markdown format
- Keep documentation synchronized with code
- Update documentation when making architectural changes

---

## Testing & Quality

### Before Committing
- Test in both light and dark mode
- Test responsive design (mobile, tablet, desktop)
- Verify accessibility (keyboard navigation, screen readers)
- Check browser compatibility
- Run build to ensure no errors
- Verify images load correctly
- Test component loading

### Performance Checks
- Run Lighthouse audit (or `npm run lighthouse:ci` for automated testing)
- Check Core Web Vitals (LCP, FID, INP, CLS, FCP, TTFB) - tracked automatically in console
- Verify bundle sizes (`npm run check-bundles`)
- Test on slow connections
- Review bundle analyzer (`stats.html` in build output)

### Accessibility Checks
- Run accessibility tests (`npm run accessibility:all`)
- Check contrast ratios (`npm run accessibility:contrast`)
- Run axe-core audit (`npm run accessibility:axe`)
- Run pa11y audit (`npm run accessibility:pa11y`)
- Test keyboard navigation
- Verify screen reader compatibility
- See `docs/ACCESSIBILITY_TESTING.md` for detailed testing guide

---

## Git & Version Control

### File Organization
- Never commit `dist/` or `dist-gh-pages/` directories (gitignored)
- Never commit `node_modules/` (gitignored)
- Commit source files, not generated files
- Keep `.gitignore` up-to-date
- GitHub Actions workflow (`.github/workflows/static.yml`) handles GitHub Pages deployment automatically

### Commit Messages
- Use descriptive commit messages
- Reference issue numbers if applicable
- Group related changes in single commits

---

## Common Patterns

### Event Handler Pattern
```javascript
// Prefer event delegation
document.body.addEventListener('click', (e) => {
  const target = e.target.closest('.selector');
  if (target) {
    // Handler logic
  }
});

// For scroll events, use unified scroll handler
import { initScrollHandlers } from '../utils/scroll-handler.js';
initScrollHandlers();
```

### Initialization Pattern
```javascript
const initFeature = () => {
  const element = $('#element');
  if (!element) {
    setTimeout(initFeature, 100);
    return;
  }
  
  if (element.dataset.initialized === 'true') return;
  element.dataset.initialized = 'true';
  
  // Initialize feature
};
```

### Component Loading Pattern
```javascript
await loadComponent('components/navbar.html', '#navbar-placeholder', () => {
  // Callback after component loads
  initDependentFeature();
});
```

---

## Configuration

### App Configuration
- Centralized config in `config/app.config.js`
- Use `appConfig` object for all configuration
- Don't hardcode configuration values

### Build Configuration
- Vite config in `vite.config.js`
- Custom plugins in `config/` directory
- Don't modify build config without understanding impact

---

## Error Handling

### JavaScript Errors
- Use try-catch for async operations
- Provide fallbacks for missing elements
- Log errors to console with context
- Don't fail silently

### Component Loading
- Handle missing components gracefully
- Provide fallback UI if component fails to load
- Log errors for debugging

---

## Browser Support

### Target Browsers
- Chrome (latest)
- Firefox (latest)
- Safari (latest)
- Edge (latest)

### Features Used
- ES6+ JavaScript (async/await, arrow functions, const/let)
- CSS Grid and Flexbox
- CSS Custom Properties
- Intersection Observer API
- Fetch API

### Polyfills
- No polyfills currently needed
- Add polyfills if supporting older browsers

---

## Security

### Best Practices
- Sanitize user input in forms
- Validate all form data
- Use HTTPS for production
- Don't expose sensitive data in client-side code
- Keep dependencies up-to-date

---

## When Adding New Features

1. **Follow existing patterns** - Match the style and structure of existing code
2. **Use utility functions** - Don't reinvent the wheel, use existing utils
3. **Add to appropriate file** - Page-specific code in page files, shared code in shared files
4. **Update documentation** - Add JSDoc comments and update relevant docs
5. **Test thoroughly** - Test in both modes, all screen sizes, and browsers
6. **Consider performance** - Lazy load if appropriate, optimize assets
7. **Maintain accessibility** - Ensure keyboard navigation and screen reader support
8. **Update this file** - If adding new patterns or conventions, update cursorrules.mdc

---

## Quick Reference

### CSS Variables
- Colors: `var(--color-*)`
- Spacing: `var(--space-*)`
- Typography: `var(--font-primary)`
- Shadows: `var(--shadow-*)`
- Radius: `var(--radius-*)`
- Transitions: `var(--transition-*)`

### JavaScript Utilities
- **DOM**: `$()`, `$$()`, `waitForElement()`, `isInViewport()`
- **Performance**: `debounce()`, `throttle()`, `logPerformance()`
- **Validation**: `validateEmail()`, `validatePhone()`, `showError()`, `showSuccessMessage()`
- **Theme**: `themeManager` (auto-initialized), `getTheme()`, `setTheme()`, `toggleTheme()`
- **Path**: `getBasePath()`, `getResourcePath()` (for GitHub Pages compatibility)
- **Cache**: `cacheManager` from `js/cache-manager.js` (in-memory caching, `getStats()`, `clear()`)
- **Monitoring**: `initMonitoring()` from `js/monitoring.js` (error tracking & performance monitoring)

### Build Commands
- `npm run dev` - Development server
- `npm run build` - Production build (normal server)
- `npm run build:gh-pages` - GitHub Pages build
- `npm run build:all` - Build both targets
- `npm run preview` - Preview production build
- `npm run preview:gh-pages` - Preview GitHub Pages build
- `npm run lighthouse` - Run Lighthouse CI (full test, 3 runs)
- `npm run lighthouse:ci` - Run Lighthouse CI (quick test, 1 run)
- `npm run check-bundles` - Check production build bundle sizes
- `npm run check-bundles:gh-pages` - Check GitHub Pages build bundle sizes

### Accessibility Testing Commands
- `npm run accessibility:all` - Run all accessibility tests
- `npm run accessibility:contrast` - Check text contrast ratios
- `npm run accessibility:axe` - Run axe-core audit
- `npm run accessibility:pa11y` - Run pa11y audit

### Form Handling
- Forms use **Formspree** for backend submission
- Form endpoint: `https://formspree.io/f/xvgjddqj`
- Forms validate client-side, then submit via fetch API
- Loading states and error handling included

### Interactive Features
- **Particles Background**: Animated particle network in CTA sections (`js/particles-net.js`)
  - Compatible with particles.js configuration format
  - Mouse interaction (hover repulse, click to push)
  - Lazy-loaded for performance and disabled on touch/mobile devices (coarse pointers)
  - Configured via `js/particlesjs-config.json`
- **Testimonials Carousel**: Centered active card, infinite loop, drag & shift+scroll navigation
- **Instagram Feed**: Carousel with local image fallback (uses `assets/images/instagram/` if API unavailable)
- **WhatsApp Button**: Floating action button (bottom-left) with tooltip
- **Scroll to Top**: Floating button (bottom-right) appears after 500px scroll
- **Address Links**: All addresses link to Google Maps (`https://maps.app.goo.gl/LxbQUQxCa3b6b7Jm6`)
- **Footer Logo**: Links to homepage (`index.html`) with proper accessibility attributes
- **Services Dropdown**: Links to services page + individual service sections
- **Theme Toggle**: Works on all pages with FOUC prevention
- **Page Transitions**: Smooth navigation with skeleton loading (`js/page-transitions.js`)
  - Intercepts internal link clicks for instant navigation
  - Shows skeleton overlay during transition
  - In-memory cache for instant page loads
  - Connection-aware (disabled on slow connections)
- **Timeline Component**: Vertical timeline flow for process/journey sections (`css/components/timeline.css`)
  - Alternating left/right card layout on desktop
  - Curved connector shapes with clip-path animations
  - Connection dots at timeline center line
  - Responsive mobile layout (single column)
  - Uses transform for precise card alignment with connector apex
  - AOS scroll animations for reveal effects
- **Skeleton Loaders**: Animated loading placeholders (`css/components/skeleton.css`)
  - Shimmer animation with dark mode support
  - Used for components, testimonials, Instagram feed, page transitions
  - Respects `prefers-reduced-motion`
- **Enhanced Caching**: Multi-layer caching strategy
  - Service worker: Long-term cache for static assets, short-term for HTML
  - In-memory cache: Fast access for pages and data
  - Cache warming: Pre-loads critical pages/data in background
  - Works in dev, preview, production, and GitHub Pages

### Documentation
**Core Documentation:**
- **Setup & Getting Started**: `README.md` (quick start)
- **Setup Guide**: `docs/SETUP_GUIDE.md` (developer workflow)
- **Architecture**: `docs/ARCHITECTURE.md` (project structure)
- **CSS Structure**: `docs/CSS_STRUCTURE.md` (modular CSS architecture reference)
- **Style Guide**: `docs/STYLE_GUIDE.md` (CSS conventions)

**Feature Setup:**
- **Google Reviews**: `docs/GOOGLE_REVIEWS_SETUP.md` (testimonials carousel)
- **Instagram Feed**: `docs/INSTAGRAM_FEED_SETUP.md` (Instagram feed with local fallback)
- **GitHub Actions**: `docs/GITHUB_ACTIONS_SETUP.md` (secrets configuration)
- **Monitoring**: `docs/MONITORING_SETUP.md` (Sentry error tracking, Core Web Vitals, Lighthouse CI, bundle monitoring)

**Optimization & Best Practices:**
- **Performance**: `docs/PERFORMANCE_OPTIMIZATION.md` (optimization strategies, caching, browser compatibility)
- **Performance Checklist**: `docs/PERFORMANCE_CHECKLIST.md` (primary quick reference)
- **Image Guide**: `docs/IMAGE_GUIDE.md` (image implementation, source format guidelines)
- **Fonts**: `docs/FONTS.md` (font self-hosting, Font Awesome optimization, path resolution)
- **Network**: `docs/NETWORK_OPTIMIZATION.md` (server-side optimization)
- **Responsive**: `docs/RESPONSIVE_DESIGN.md` (responsive patterns)
- **SEO**: `docs/SEO_RECOMMENDATIONS.md` (SEO strategy)

**Deployment:**
- **Dual Build System**: `docs/DUAL_BUILD_GUIDE.md` (production + GitHub Pages)

---

**Last Updated**: January 2025
**Version**: 3.4

## Recent Major Updates (January 2025)

### Google Reviews Integration ✅
- Dynamic Google Reviews carousel in testimonials section
- Build-time fetching from Google Places API (Legacy)
- Centered active card with infinite loop
- Interactive controls: drag, shift+scroll, arrow buttons, dots
- Auto-scroll with pause on hover
- Uniform card heights with responsive design
- Fallback to manual reviews if API unavailable
- See `docs/GOOGLE_REVIEWS_SETUP.md` for setup

### Floating Action Buttons ✅
- **WhatsApp Button**: Fixed bottom-left, always visible, tooltip on hover
- **Scroll to Top Button**: Fixed bottom-right, appears after 500px scroll
- Both buttons responsive, hidden in print media
- Proper z-index layering and accessibility

### Address Links ✅
- All address instances link to Google Maps
- Consistent implementation across footer, contact page, legal pages
- Opens in new tab with security attributes

### SEO Implementation ✅
- Open Graph tags on all pages
- Twitter Card tags on all pages
- Structured Data (JSON-LD) schemas (Organization, LocalBusiness, Service, BreadcrumbList)
- Canonical URLs on all pages
- robots.txt file
- Updated sitemap.xml with current dates

### Dual Build System ✅
- Production build: `dist/` → `https://www.logia.co.za`
- GitHub Pages build: `dist-gh-pages/` → `https://courage-1984.github.io/logia`
- Automatic URL transformation based on build target
- GitHub Actions workflow for automated deployment

### Form Integration ✅
- Formspree backend integration
- Client-side validation with server submission
- Loading states and error handling

### Legal Pages ✅
- privacy-policy.html
- terms-of-service.html
- 404.html error page
- Enhanced UI with `css/legal.css` (card layout, section dividers, styled contact section)
- Reduced hero section height for better content visibility

### Theme System Optimization ✅
- Unified theme manager (`utils/theme.js`, `js/utils/theme.js`)
- System preference detection (`prefers-color-scheme`)
- FOUC prevention on all pages (inline script in `<head>`)
- Smooth transitions (300ms via `--transition-theme`)
- Event system for component synchronization
- Works consistently across all pages

### Path Utilities ✅
- `utils/path.js` for GitHub Pages compatibility
- `getBasePath()` - Detects deployment environment
- `getResourcePath()` - Builds correct resource paths
- Used by testimonials, Instagram feed, and blur placeholders

### CSS Modularization ✅ (January 2025)
- **Modular Structure**: CSS reorganized into `core/`, `components/`, `layout/`, `sections/`, `pages/`, `responsive/`, `fonts/`
- **Split large files**: `sections.css` (1,441 lines) split into 7 focused section files
- **Component extraction**: Cards, forms, carousel, floating buttons extracted to reusable components
- **Font organization**: Fonts moved to `css/fonts/` with corrected paths (`../../assets/fonts/...`)
- **All legacy files removed**: Migration completed with zero breaking changes
- **See**: `docs/CSS_STRUCTURE.md` for complete reference guide

### GitHub Actions Enhancement ✅
- Secrets support for API keys (GOOGLE_PLACES_API_KEY, GOOGLE_PLACE_ID, INSTAGRAM_ACCESS_TOKEN)
- Separate fetch steps before build
- Graceful fallback if secrets not set
- See `docs/GITHUB_ACTIONS_SETUP.md` for setup

### Instagram Feed Improvement ✅
- Uses local images from `assets/images/instagram/` when API unavailable
- Automatic image detection by post ID
- No API calls needed if images already exist
- Faster execution and works in GitHub Actions without token

### Font Awesome Cross-Browser Fixes ✅
- Fixed Firefox compatibility issues with Font Awesome icons
- Quoted URLs in all @font-face declarations (Firefox requirement)
- Added semicolons to all @font-face src properties
- Root font-size normalization with `text-size-adjust: 100%` to prevent browser font preferences from affecting rem/em calculations
- Explicit icon sizing and rendering properties for consistent cross-browser display
- **Font paths fixed**: Updated to `../../assets/fonts/fontawesome/...` after CSS modularization (CSS files now in `css/fonts/`)
- Icons now render consistently across Chrome, Firefox, Safari, and Edge

### Particles Background System ✅
- **Implementation**: `js/particles-net.js` - Clean particles.js-compatible implementation (ES6 class-based)
- **Configuration**: `js/particlesjs-config.json` - Standard particles.js format (copied to build output)
- **Features**: Mouse interaction (repulse on hover, push on click), line linking, retina support, out_mode handling
- **Performance**: Lazy-loaded via `main.js`, IntersectionObserver for visibility pausing
- **Integration**: Automatically initializes on all `.cta-section .cta-background` elements
- **Event Handling**: Listens on `.cta-section` parent to capture events even when hovering over content
- **Canvas**: Uses `pointer-events: none` to avoid blocking content interactions

### Monitoring & Error Tracking ✅
- **Error Tracking**: Sentry integration (`js/monitoring.js`) - JavaScript error monitoring in production
  - Session replay (10% of sessions, 100% of error sessions)
  - Browser extension error filtering
  - Configured via environment variables (`VITE_SENTRY_DSN`, `VITE_SENTRY_ENABLED`)
- **Performance Monitoring**: Core Web Vitals tracking (LCP, FID, INP, CLS, FCP, TTFB) - enabled by default
  - Logs to console by default
  - Optional Sentry integration
  - Custom analytics events support
- **Lighthouse CI**: Automated performance testing with budgets (`lighthouserc.cjs`)
  - Runs on pull requests and pushes to main
  - Performance budgets (warnings for tracking, errors for critical metrics)
  - GitHub Actions workflow (`.github/workflows/lighthouse.yml`)
- **Bundle Size Monitoring**: Tracks JavaScript, CSS, images, fonts over time (`scripts/check-bundle-sizes.js`)
  - Budget enforcement
  - History tracking (`.bundle-history/bundle-sizes.json`)
  - Change detection from previous builds
- **Skip Links**: Accessibility navigation links on all pages
  - Skip to main content (`#main-content`)
  - Skip to services (`#services`) - homepage only
  - Skip to footer (`#footer`)
  - Styled in `css/style.css` (hidden by default, visible on focus)
- **Configuration**: `config/app.config.js` - Monitoring settings with environment variable support
- See `docs/MONITORING_SETUP.md` for setup instructions

### Build & Development Improvements ✅ (January 2025)
- **Preload Optimization**: Removed preload links for responsive images (causes browser warnings) - use `loading="eager"` and `fetchpriority="high"` on `<img>` instead
- **Dynamic Import Fix**: Changed `particles-net.js` to use static import for `getResourcePath` (fixes preview server issues)
- **Preview Server Configuration**: Enhanced preview server with strict file serving (only serves built files from dist)
- **CSP Updates**: Added `https://speed.cloudflare.com` to `frame-src` for speedtest page
- **Footer Logo**: Footer logo now links to homepage with proper accessibility attributes
- **Portfolio Preview Cards**: Homepage "Featured Projects" section now matches portfolio page styling (responsive images, project stats, proper structure)

### Page Transitions & Skeleton Loaders ✅ (January 2025)
- **Skeleton Loaders**: Animated loading placeholders with shimmer effect (`css/components/skeleton.css`)
  - Variants for navbar, footer, testimonials, Instagram, cards, buttons
  - Dark mode support
- **Page Transitions**: Smooth navigation system (`js/page-transitions.js`)
  - Intercepts internal link clicks for instant navigation
  - Shows skeleton overlay during transition
  - Fetches and caches pages for instant subsequent loads
  - Connection-aware (disabled on slow connections)
  - Works with GitHub Pages base path

### Enhanced Caching Strategy ✅ (January 2025)
- **Service Worker Enhancements**: Multi-layer caching with size limits and automatic cleanup
  - Static assets: 50MB cache-first with stale-while-revalidate
  - HTML: 10MB network-first with cache fallback
  - Data: 5MB cache-first with 1-hour TTL
  - Cache versioning and automatic cleanup
- **In-Memory Cache**: Fast JavaScript caching (`js/cache-manager.js`)
  - Page cache: 10 pages, 30-minute TTL (instant page transitions)
  - Data cache: 50 entries, 5-minute TTL (testimonials, Instagram)
  - LRU eviction and automatic expiration
- **Cache Warming**: Background pre-loading (`js/cache-warming.js`)
  - Pre-loads critical pages (about, services, contact, portfolio)
  - Pre-loads critical data (Google Reviews, Instagram posts)
  - Connection-aware, respects data saver mode
- **Works in all environments**: Dev, preview, production, GitHub Pages

### Timeline Component ✅ (January 2025)
- **Implementation**: Vertical timeline flow component (`css/components/timeline.css`)
- **Usage**: "Our Process" section on services page showing step-by-step workflow
- **Features**: 
  - Alternating left/right card layout on desktop (centered vertical line)
  - Curved connector shapes using CSS clip-path with gradient backgrounds
  - Connection dots at timeline center line with pulse animation
  - Scroll-triggered animations (AOS library)
  - Responsive mobile layout (single column, left-aligned)
  - Precise card-to-connector alignment using CSS transforms
- **Layout Details**:
  - Desktop: 50% width cards, zigzag pattern from center line
  - Connector: 80px wide, absolutely positioned, curved clip-path shapes
  - Gap neutralized: Flex gap set to 0 for precise positioning
  - Transform fix: Uses `translateX()` for exact alignment (handles row-reverse flex behavior)
- **See**: Used in `services.html` for "Our Process" timeline section

### Chrome Animation Optimization ✅ (January 2025)
- **Fixed jittery animations in Chrome** - Comprehensive optimization for smooth animations
- **Key Changes**:
  - Removed all `prefers-reduced-motion` rules (animations always enabled)
  - Optimized `will-change` usage (only set during active animations, removed when idle)
  - Added CSS containment (`contain: layout style paint`) for better rendering isolation
  - Removed unnecessary `translate3d(0,0,0)` - use only needed transforms (`scale()`, `translateY()`, etc.)
  - Use separate transition properties instead of shorthand for better Chrome performance
  - Carousel JavaScript updated to use CSS classes (`is-dragging`) instead of inline styles
- **Files Updated**: `css/sections/portfolio-preview.css`, `css/layout/hero.css`, `css/sections/testimonials.css`, `css/sections/instagram.css`, `css/core/reset.css`, `js/main.js`, `js/testimonials.js`, `js/instagram-feed.js`
- **Result**: Smooth animations in Chrome matching Firefox performance
